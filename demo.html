<html>
	<head>
		<title>HTML Generator</title>
		<meta content="">
		<meta charset="utf-8">
		<style>
			html, body {
				padding: 0;
				margin: 0;
			}

			#container {
				width:100vw;
				height:100vh;
				display: -ms-grid;
				display: grid;
				position: relative;
				-ms-grid-columns: 50% 50%;
				-ms-grid-rows: 30px 45% 45%;
				grid-template-columns: 50% 50%;
				grid-template-rows: 30px auto 45%;
				grid-template-areas:
				"blockly     title"
				"blockly     website"
				"blockly     code";
			}

			#filename {
				position: absolute;
				top: 10px;
				left: 24%;
				background-color: rgba(115, 115, 115, 0.5);
				color:white;
				text-align:center;
				font-size: 20px;
				font-family: sans-serif;
				padding: 5px;
				border-radius: 5px;
			}

			#blocklyArea	{grid-area: blockly;}
			#title			{grid-area: title; width: 100%; background-color: #444; color:white; text-align:center; font-size: 20px; font-family: sans-serif; padding-top: 5px; }
			#websiteFrame	{grid-area: website; border: 5px solid #444;  -ms-grid-row:1; -ms-grid-column:2; }
			#sourcecode		{grid-area: code; border: 5px solid lightgray;overflow: scroll; margin:0px;  -ms-grid-row:3;-ms-grid-column:2;grid-row:3;grid-column: 2;}
			#website		{width: calc(100% - 5px);height: calc(100% - 5px);}

			_:-ms-lang(x),
			#container {
				width:98vw;
			}
		</style>
		<script src="blockly_compressed.js"></script>
		<script src="de.js"></script>
		<script src="blocks_compressed.js"></script>
		<script src="javascript_compressed.js"></script>
		<script src="html_de.js"></script>
		<script src="html_generators.js"></script>
		<script src="html_blocks.js"></script>
	</head>

	<body>
		<div id="container">
			<div id="blocklyArea"></div>
			<div id="title">untitled</div>
			<div id="websiteFrame"><iframe id="website"></iframe></div>
			<pre id="sourcecode"></pre>
			<input type="file" id="fileButton" style="display:none;" />
		</div>
		<div class="filename" id="fileName"></div>
	</body>

	<xml xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
		<category name="Menu" expanded="false">
			<button name="new" text="New" callbackKey="newKey"></button>
			<button name="load" text="Load" callbackKey="loadKey"></button>
			<button name="save" text="Save" callbackKey="saveKey"></button>
			<button name="export" text="Export" callbackKey="exportKey"></button>
		</category>
		<category name="html" expanded="true">
			<category name="baseframe" colour="#a55b5b">
				<block type="html">
					<statement name="content">
						<block type="head">
							<statement name="content">
								<block type="title">
									<statement name="content">
										<block type="plaintext"></block>
									</statement>
								</block>
							</statement>
							<next>
								<block type="body"></block>
							</next>
						</block>
					</statement>
				</block>
				<block type="html"></block>
				<block type="body"></block>
				<block type="body_attributes"></block>
				<block type="head"></block>
				<block type="styletag"></block>
				<block type="styleclass"></block>
				<block type="title">
					<statement name="content">
						<block type="plaintext"></block>
					</statement>
				</block>
			</category>
			<category name="textstructure" colour="#5ba55b">
				<block type="plaintext"></block>
				<block type="horizontalbreak"></block>
				<block type="linebreak"></block>
				<block type="paragraph"></block>
				<block type="headline"></block>
				<block type="link"></block>
					<block type="image"><field name="ALT">alternative text</field>
				</block>
				<block type="generictag"></block>
			</category>
			<category name="markup" colour="#5ba55b">
				<block type="emphasise"></block>
				<block type="inserted"></block>
				<block type="strong"></block>
				<block type="deleted"></block>
				<block type="super"></block>
				<block type="sub"></block>
				<block type="code"></block>
				<block type="quote"></block>
				<block type="blockquote"></block>
				<block type="sample"></block>
				<block type="keyboard"></block>
				<block type="variable"></block>
				<block type="division"></block>
			</category>
			<category name="style" colour="#5b6da5">
				<block type="span">
					<value name="NAME">
						<block type="style"></block>
					</value>
				</block>
				<block type="style"></block>
				<block type="color"></block>
				<block type="bgcolour"></block>
				<block type="textalign"></block>
					<block type="genericstyle"><field name="value">value</field>
				</block>
				<block type="span"></block>
				<block type="division"></block>
				<block type="generictag"></block>
			</category>
			<category name="enumerations" colour="#a55ba5">
				<block type="unorderedlist"></block>
				<block type="orderedlist"></block>
				<block type="listelement"></block>
			</category>
			<category name="tables" colour="#5ba5a5">
				<block type="table">
					<statement name="content">
				<block type="tablerow">
				<statement name="content">
					<block type="tablecell">
					<next>
						<block type="tablecell"></block>
					</next>
					</block>
				</statement>
				<next>
					<block type="tablerow">
					<statement name="content">
						<block type="tablecell">
						<next>
							<block type="tablecell"></block>
						</next>
						</block>
					</statement>
					</block>
				</next>
				</block>
			</statement>
				</block>
				<block type="table"></block>
				<block type="tablerow"></block>
				<block type="tablecell"></block>
			</category>
			<category name="forms" colour="#80a55b">
				<block type="form"></block>
				<block type="input_text"></block>
				<block type="button"></block>
					<block type="input"><field name="value"></field>
				</block>
			</category>
			<category name="scripts" colour="#a5a55b">
				<block type="script"></block>
				<block type="onclick"></block>
			</category>
		</category>
		<sep></sep>
		<category name="scripting">
			<category name="logic" colour="#5C81A6">
				<block type="controls_if"></block>
				<block type="logic_compare"></block>
				<block type="logic_operation"></block>
				<block type="logic_negate"></block>
				<block type="logic_boolean"></block>
				<block type="logic_null"></block>
				<block type="logic_ternary"></block>
			</category>
			<category name="loops" colour="#5CA65C">
				<block type="controls_repeat_ext">
				<value name="TIMES">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="controls_whileUntil"></block>
				<block type="controls_for"><value name="FROM">
					<shadow type="math_number"></shadow>
				</value>
				<value name="TO">
					<shadow type="math_number"></shadow>
				</value>
				<value name="BY">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="controls_forEach"></block>
				<block type="controls_flow_statements"></block>
			</category>
			<category name="math" colour="#5C68A6">
				<block type="math_round"><value name="NUM">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_number"></block>
				<block type="math_single"><value name="NUM">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_trig"><value name="NUM">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_constant"></block>
				<block type="math_number_property">
				<mutation divisor_input="false"></mutation><value name="NUMBER_TO_CHECK">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_arithmetic"><value name="A">
					<shadow type="math_number"></shadow>
				</value>
				<value name="B">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_on_list">
				<mutation op="SUM"></mutation></block>
				<block type="math_modulo">
				<value name="DIVIDEND">
					<shadow type="math_number"></shadow>
				</value>
				<value name="DIVISOR">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_constrain">
				<value name="VALUE">
					<shadow type="math_number"></shadow>
				</value>
				<value name="LOW">
					<shadow type="math_number"></shadow>
				</value>
				<value name="HIGH">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_random_int">
				<value name="FROM">
					<shadow type="math_number"></shadow>
				</value>
				<value name="TO">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="math_random_float"></block>
			</category>
			<category name="text" colour="#5CA68D">
				<block type="text_charAt">
				<mutation at="true"></mutation><value name="VALUE">
					<block type="variables_get"></block>
				</value>
				</block>
				<block type="text"></block>
				<block type="text_append"><value name="TEXT">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_length">
				<value name="VALUE">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_isEmpty">
				<value name="VALUE">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_indexOf"><value name="VALUE">
					<block type="variables_get"></block>
				</value>
				<value name="FIND">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_join">
				<mutation items="2"></mutation>
				</block>
				<block type="text_getSubstring">
				<mutation at1="true" at2="true"></mutation><field name="WHERE2">FROM_START</field>
				<value name="STRING">
					<block type="variables_get"></block>
				</value>
				</block>
				<block type="text_changeCase"><value name="TEXT">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_trim"><value name="TEXT">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_print">
				<value name="TEXT">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="text_prompt_ext">
				<mutation type="TEXT"></mutation><value name="TEXT">
					<shadow type="text"></shadow>
				</value>
				</block>
			</category>
			<category name="lists" colour="#745CA6">
				<block type="lists_indexOf"><value name="VALUE">
					<block type="variables_get"></block>
				</value>
				</block>
				<block type="lists_create_with">
				<mutation items="0"></mutation>
				</block>
				<block type="lists_repeat">
				<value name="NUM">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="lists_length"></block>
				<block type="lists_isEmpty"></block>
				<block type="lists_create_with">
				<mutation items="3"></mutation>
				</block>
				<block type="lists_getIndex">
				<mutation statement="false" at="true"></mutation><field name="WHERE">FROM_START</field>
				<value name="VALUE">
					<block type="variables_get"></block>
				</value>
				</block>
				<block type="lists_setIndex">
				<mutation at="true"></mutation><field name="WHERE">FROM_START</field>
				<value name="LIST">
					<block type="variables_get"></block>
				</value>
				</block>
				<block type="lists_getSublist">
				<mutation at1="true" at2="true"></mutation><field name="WHERE2">FROM_START</field>
				<value name="LIST">
					<block type="variables_get"></block>
				</value>
				</block>
				<block type="lists_split">
				<mutation mode="SPLIT"></mutation><value name="DELIM">
					<shadow type="text"></shadow>
				</value>
				</block>
				<block type="lists_sort"><field name="DIRECTION">1</field>
				</block>
			</category>
			<category name="colour" colour="#A6745C">
				<block type="colour_picker"></block>
				<block type="colour_random"></block>
				<block type="colour_rgb">
				<value name="RED">
					<shadow type="math_number"></shadow>
				</value>
				<value name="GREEN">
					<shadow type="math_number"></shadow>
				</value>
				<value name="BLUE">
					<shadow type="math_number"></shadow>
				</value>
				</block>
				<block type="colour_blend">
				<value name="COLOUR1">
					<shadow type="colour_picker"></shadow>
				</value>
				<value name="COLOUR2">
					<shadow type="colour_picker"></shadow>
				</value>
				<value name="RATIO">
					<shadow type="math_number"></shadow>
				</value>
				</block>
			</category>
			<category name="variables" colour="#A65C81" custom="VARIABLE"></category>
			<category name="functions" colour="#9A5CA6" custom="PROCEDURE"></category>
		</category>
	</xml>

	<script>
		var newFileTranslation = "";
		if (typeof(Msg) == "object"){
			if (Msg.categories) {
				for (category in Msg.categories) {
					elements = document.getElementsByName(category);
					if (elements.length == 0) {
						continue;
					}
					elements[0].setAttribute("name", Msg.categories[category]);
				}
			}
			if (Msg.button) {
				for (button in Msg.button) {
					elements = document.getElementsByName(button);
					if (elements.length == 0) {
						continue;
					}
					elements[0].setAttribute("Text", Msg.button[button]);
				}
			}
			if (Msg.custom) {
				for (item in Msg.custom) {
					element = document.getElementById(item);
					if (element) {
						var translated = Msg.custom[item];
						if (item === "fileName") {
							newFileTranslation = translated;
						}
						element.textContent = translated;
					}
				}
			}
		}

		var toolbox = document.getElementById("toolbox");
		var blocklyArea = document.getElementById('blocklyArea');
		var fileButton = document.getElementById('fileButton');
		var fileName = document.getElementById('fileName');
		fileName.innerText = newFileTranslation;

		var options = {
			toolbox : toolbox,
			collapse : true,
			comments : false,
			disable : false,
			maxBlocks : Infinity,
			trashcan : true,
			horizontalLayout : false,
			tooltips: true,
			css : true,
			media : 'https://blockly-demo.appspot.com/static/media/',
			rtl : false,
			scrollbars : true,
			sounds : true,
			oneBasedIndex : true
		};

		var workspace = Blockly.inject(blocklyArea, options);
		Blockly.svgResize(workspace);

		function autoUpdateFunction(event) {
			var code = HtmlGenerator.workspaceToCode(workspace);
			document.getElementById('sourcecode').innerText = code;
			document.getElementById('website').src = "data:text/html;charset=utf-8," + encodeURIComponent(code);
		}
		workspace.addChangeListener(autoUpdateFunction);

		workspace.registerButtonCallback('newKey', function(button) {
			workspace.clear();
			fileName.innerText = newFileTranslation;
		});

		function saveBlocks() {
			var xml = Blockly.Xml.workspaceToDom(workspace);
			var xml_text = Blockly.Xml.domToText(xml);
			window.open("data:application/octet-stream," + encodeURIComponent(xml_text), 'blockly.xml');
		}
		workspace.registerButtonCallback('saveKey', function(button) {
			saveBlocks();
		});

		function exportHtml() {
			var code = HtmlGenerator.workspaceToCode(workspace);
			window.open("data:application/octet-stream," + encodeURIComponent(code), 'blockly.html');
		}
		workspace.registerButtonCallback('exportKey', function(button) {
			exportHtml();
		});

		function loadBlocks(e) {
			var file = e.target.files[0];
			if (!file) {
				return;
			}
			var reader = new FileReader();
			reader.onload = function(e) {
				var xml_text = e.target.result;
				if (xml_text) {
					var xml = Blockly.Xml.textToDom(xml_text);
					Blockly.Xml.domToWorkspace(xml, workspace);
					fileName.innerText = file.name;
				}
			};
			reader.readAsText(file);
		}
		fileButton.addEventListener('change', loadBlocks, false);
		workspace.registerButtonCallback('loadKey', function(button) {
			fileButton.click();
		});

	</script>
</html>
